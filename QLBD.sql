CREATE DATABASE QLBD
GO

USE QLBD
GO

CREATE TABLE CAUTHU (
	MACT NUMERIC IDENTITY(1, 1) NOT NULL,
	HOTEN NVARCHAR(100) NOT NULL,
	VITRI NVARCHAR(20) NOT NULL,
	NGAYSINH DATETIME,
	DIACHI NVARCHAR(200),
	MACLB VARCHAR(5) NOT NULL,
	MAQG VARCHAR(5) NOT NULL,
	SO INT NOT NULL
)

ALTER TABLE CAUTHU
ADD CONSTRAINT PK_CT PRIMARY KEY (MACT)

CREATE TABLE QUOCGIA (
	MAQG VARCHAR(5) NOT NULL PRIMARY KEY,
	TENQG NVARCHAR(60) NOT NULL
)

CREATE TABLE CAULACBO (
	MACLB VARCHAR(5) NOT NULL PRIMARY KEY,
	TENCLB NVARCHAR(100) NOT NULL,
	MASAN VARCHAR(5) NOT NULL,
	MATINH VARCHAR(5) NOT NULL
)

CREATE TABLE TINH (
	MATINH VARCHAR(5) NOT NULL PRIMARY KEY,
	TENTINH NVARCHAR(100) NOT NULL
)

CREATE TABLE SANVD (
	MASAN VARCHAR(5) NOT NULL PRIMARY KEY,
	TENSAN NVARCHAR(100) NOT NULL,
	DIACHI NVARCHAR(200)
)

CREATE TABLE HUANLUYENVIEN (
	MAHLV VARCHAR(5) NOT NULL PRIMARY KEY,
	TENHLV NVARCHAR(100) NOT NULL,
	NGAYSINH DATETIME,
	DIACHI NVARCHAR(200),
	DIENTHOAI NVARCHAR(20),
	MAQG VARCHAR(5) NOT NULL
)

CREATE TABLE HLV_CLB (
	MAHLV VARCHAR(5) NOT NULL,
	MACLB VARCHAR(5) NOT NULL,
	VAITRO NVARCHAR(100) NOT NULL,
	PRIMARY KEY (MAHLV, MACLB)
)

CREATE TABLE TRANDAU (
	MATRAN NUMERIC NOT NULL IDENTITY(1, 1) PRIMARY KEY,
	NAM INT NOT NULL,
	VONG INT NOT NULL,
	NGAYTD DATETIME NOT NULL,
	MACLB1 VARCHAR(5) NOT NULL,
	MACLB2 VARCHAR(5) NOT NULL,
	MASAN VARCHAR(5) NOT NULL,
	KETQUA VARCHAR(5) NOT NULL
)

CREATE TABLE BANGXH (
	MACLB VARCHAR(5) NOT NULL,
	NAM INT NOT NULL,
	VONG INT NOT NULL,
	SOTRAN INT NOT NULL,
	THANG INT NOT NULL,
	HOA INT NOT NULL,
	THUA INT NOT NULL,
	HIEUSO VARCHAR(5) NOT NULL,
	DIEM INT NOT NULL,
	HANG INT NOT NULL,
	PRIMARY KEY (MACLB, NAM, VONG)
)

ALTER TABLE CAUTHU
ADD CONSTRAINT FK_CT_CLB FOREIGN KEY (MACLB) REFERENCES CAULACBO (MACLB)
ALTER TABLE CAUTHU
ADD CONSTRAINT FK_CT_QG FOREIGN KEY (MAQG) REFERENCES QUOCGIA (MAQG)

ALTER TABLE CAULACBO
ADD CONSTRAINT FK_CLB_SVD FOREIGN KEY (MASAN) REFERENCES SANVD (MASAN)
ALTER TABLE CAULACBO
ADD CONSTRAINT FK_CLB_TINH FOREIGN KEY (MATINH) REFERENCES TINH (MATINH)

ALTER TABLE HUANLUYENVIEN
ADD CONSTRAINT FK_HLV_QG FOREIGN KEY (MAQG) REFERENCES QUOCGIA (MAQG)

ALTER TABLE HLV_CLB
ADD CONSTRAINT FK_HLVCLB_HLV FOREIGN KEY (MAHLV) REFERENCES HUANLUYENVIEN (MAHLV)
ALTER TABLE HLV_CLB
ADD CONSTRAINT FK_HLVCLB_CLB FOREIGN KEY (MACLB) REFERENCES CAULACBO (MACLB)

ALTER TABLE TRANDAU
ADD CONSTRAINT FK_TD_CLB1 FOREIGN KEY (MACLB1) REFERENCES CAULACBO (MACLB)
ALTER TABLE TRANDAU
ADD CONSTRAINT FK_TD_CLB2 FOREIGN KEY (MACLB2) REFERENCES CAULACBO (MACLB)
ALTER TABLE TRANDAU
ADD CONSTRAINT FK_TD_SVD FOREIGN KEY (MASAN) REFERENCES SANVD (MASAN)

ALTER TABLE BANGXH
ADD CONSTRAINT FK_BXH_CLB FOREIGN KEY (MACLB) REFERENCES CAULACBO (MACLB)

INSERT INTO QUOCGIA VALUES ('VN', N'VIỆT NAM')
INSERT INTO QUOCGIA VALUES ('ANH', N'ANH QUỐC')
INSERT INTO QUOCGIA VALUES ('TBN', N'TÂY BAN NHA')
INSERT INTO QUOCGIA VALUES ('BDN', N'BỒ ĐÀO NHA')
INSERT INTO QUOCGIA VALUES ('BRA', N'BRAZIL')
INSERT INTO QUOCGIA VALUES ('ITA', N'Ý')
INSERT INTO QUOCGIA VALUES ('THA', N'THÁI LAN')

INSERT INTO SANVD
VALUES('GD', N'GÒ ĐẬU', N'123 QL1, TX THỦ DẦU 1, BÌNH DƯƠNG')
INSERT INTO SANVD
VALUES('PL', N'PLEIKU', N'22 HỒ TÙNG MẬU,THỐNG NHẤT, THỊ XÃ PLEIKU, GIA LAI')
INSERT INTO SANVD
VALUES('CL', N'CHI LĂNG', N'127 VÕ VĂN TẦN, ĐÀ NẴNG')
INSERT INTO SANVD
VALUES('NT', N'NHA TRANG', N'128 PHAN CHU TRINH, NHA TRANG, KHÁNH HÒA')
INSERT INTO SANVD
VALUES('TH', N'TUY HÒA', N'57 TRƯỜNG CHINH, TUY HÒA, PHÚ YÊN')
INSERT INTO SANVD
VALUES('LA', N'LONG AN', N'102 HÙNG VƯƠNG, TP TÂN AN, LONG AN')

INSERT INTO TINH VALUES('BD', N'BÌNH DƯƠNG')
INSERT INTO TINH VALUES('GL', N'GIA LAI')
INSERT INTO TINH VALUES('DN', N'ĐÀ NẴNG')
INSERT INTO TINH VALUES('KH', N'KHÁNH HÒA')
INSERT INTO TINH VALUES('PY', N'PHÚ YÊN')
INSERT INTO TINH VALUES('LA', N'LONG AN')

INSERT INTO CAULACBO
VALUES ('BBD', N'BECAMEX BÌNH DƯƠNG', 'GD', 'BD')
INSERT INTO CAULACBO
VALUES ('HAGL', N'HOÀNG ANH GIA LAI', 'PL', 'GL')
INSERT INTO CAULACBO
VALUES ('SDN', N'SHB ĐÀ NẴNG', 'CL', 'DN')
INSERT INTO CAULACBO
VALUES ('KKH', N'KHATOCO KHÁNH HÒA', 'NT', 'KH')
INSERT INTO CAULACBO
VALUES ('TPY' , N'THÉP PHÚ YÊN', 'TH', 'PY')
INSERT INTO CAULACBO
VALUES ('GDT', N'GẠCH ĐỒNG TÂM LONG', 'LA', 'LA')

INSERT INTO CAUTHU (HOTEN, VITRI, NGAYSINH, DIACHI, MACLB, MAQG, SO)
VALUES (N'NGUYỄN VŨ PHONG', N'TIỀN VỆ', '1990/2/20', NULL, 'BBD', 'VN', 17)
INSERT INTO CAUTHU (HOTEN, VITRI, NGAYSINH, DIACHI, MACLB, MAQG, SO)
VALUES (N'NGUYỄN CÔNG VINH', N'TIỀN ĐẠO', '1992/3/10', NULL, 'HAGL', 'VN', 9)
INSERT INTO CAUTHU (HOTEN, VITRI, NGAYSINH, DIACHI, MACLB, MAQG, SO)
VALUES (N'TRẦN TẤN TÀI', N'TIỀN VỆ', '1989/11/12', NULL, 'BBD', 'VN', 8)
INSERT INTO CAUTHU (HOTEN, VITRI, NGAYSINH, DIACHI, MACLB, MAQG, SO)
VALUES (N'PHAN HỒNG SƠN', N'THỦ MÔN', '1991/6/10', NULL, 'HAGL', 'VN', 1)
INSERT INTO CAUTHU (HOTEN, VITRI, NGAYSINH, DIACHI, MACLB, MAQG, SO)
VALUES (N'RONALDO', N'TIỀN VỆ', '1989/12/12', NULL, 'SDN', 'BRA', 7)
INSERT INTO CAUTHU (HOTEN, VITRI, NGAYSINH, DIACHI, MACLB, MAQG, SO)
VALUES (N'ROBINHO', N'TIỀN VỆ', '1989/10/12', NULL, 'SDN', 'BRA', 8)
INSERT INTO CAUTHU (HOTEN, VITRI, NGAYSINH, DIACHI, MACLB, MAQG, SO)
VALUES (N'VIDIC', N'HẬU VỆ', '1987/10/15', NULL, 'HAGL', 'ANH', 3)
INSERT INTO CAUTHU (HOTEN, VITRI, NGAYSINH, DIACHI, MACLB, MAQG, SO)
VALUES (N'TRẦN VĂN SANTOS', N'THỦ MÔN', '1990/10/21', NULL, 'BBD', 'BRA', 1)
INSERT INTO CAUTHU (HOTEN, VITRI, NGAYSINH, DIACHI, MACLB, MAQG, SO)
VALUES (N'NGUYỄN VĂN SƠN', N'HẬU VỆ', '1993/8/26', NULL, 'BBD', 'VN', 4)

INSERT INTO HUANLUYENVIEN
VALUES ('HLV01', N'VITAL', '1975/10/15', NULL, '091802344', 'BDN')
INSERT INTO HUANLUYENVIEN
VALUES ('HLV02', N'LÊ HUỲNH ĐỨC', '1972/5/20', NULL, '0234582345', 'VN')
INSERT INTO HUANLUYENVIEN
VALUES ('HLV03', N'KIATISUK', '1970/12/11', NULL, '34582352345', 'THA')
INSERT INTO HUANLUYENVIEN
VALUES ('HLV04', N'HOÀNG ANH TUẤN', '1970/6/10', NULL, '34523452345', 'VN')
INSERT INTO HUANLUYENVIEN
VALUES ('HLV05', N'TRẦN CÔNG MINH', '1973/7/7', NULL, '32452345236', 'VN')
INSERT INTO HUANLUYENVIEN
VALUES ('HLV06', N'TRẦN VĂN PHÚC', '1975/3/2', NULL, '3452345232', 'VN')


INSERT INTO HLV_CLB
VALUES ('HLV01', 'BBD', N'HLV CHÍNH')
INSERT INTO HLV_CLB
VALUES ('HLV02', 'SDN', N'HLV CHÍNH')
INSERT INTO HLV_CLB
VALUES ('HLV03', 'HAGL', N'HLV CHÍNH')
INSERT INTO HLV_CLB
VALUES ('HLV04', 'KKH', N'HLV CHÍNH')
INSERT INTO HLV_CLB
VALUES ('HLV05', 'GDT', N'HLV CHÍNH')
INSERT INTO HLV_CLB
VALUES ('HLV06', 'BBD', N'HLV THỦ MÔN')

INSERT INTO TRANDAU(NAM, VONG, NGAYTD, MACLB1, MACLB2, MASAN, KETQUA)
VALUES (2019, 1, '2019/2/7', 'BBD', 'SDN', 'GD', '3-0')
INSERT INTO TRANDAU(NAM, VONG, NGAYTD, MACLB1, MACLB2, MASAN, KETQUA)
VALUES (2019, 1, '2019/2/7', 'KKH', 'GDT', 'NT', '1-1')
INSERT INTO TRANDAU(NAM, VONG, NGAYTD, MACLB1, MACLB2, MASAN, KETQUA)
VALUES (2019, 2, '2019/2/16', 'SDN', 'KKH', 'CL', '2-2')
INSERT INTO TRANDAU(NAM, VONG, NGAYTD, MACLB1, MACLB2, MASAN, KETQUA)
VALUES (2019, 2, '2019/2/16', 'TPY', 'BBD', 'TH', '5-0')
INSERT INTO TRANDAU(NAM, VONG, NGAYTD, MACLB1, MACLB2, MASAN, KETQUA)
VALUES (2019, 3, '2019/3/1', 'TPY', 'GDT', 'TH', '0-2')
INSERT INTO TRANDAU(NAM, VONG, NGAYTD, MACLB1, MACLB2, MASAN, KETQUA)
VALUES (2019, 3, '2019/3/1', 'KKH', 'BBD', 'NT', '0-1')
INSERT INTO TRANDAU(NAM, VONG, NGAYTD, MACLB1, MACLB2, MASAN, KETQUA)
VALUES (2019, 4, '2019/3/7', 'KKH', 'TPY', 'NT', '1-0')
INSERT INTO TRANDAU(NAM, VONG, NGAYTD, MACLB1, MACLB2, MASAN, KETQUA)
VALUES (2019, 4, '2019/3/7', 'BBD', 'GDT', 'GD', '2-2')


INSERT INTO BANGXH VALUES ('BBD', 2019, 1, 1, 1, 0, 0, '3-0', 3, 1)
INSERT INTO BANGXH VALUES ('BBD', 2019, 2, 2, 1, 0, 1, '3-5', 3, 2)
INSERT INTO BANGXH VALUES ('BBD', 2019, 3, 3, 2, 0, 1, '4-5', 6, 1)
INSERT INTO BANGXH VALUES ('BBD', 2019, 4, 4, 2, 1, 1, '6-7', 7, 1)
INSERT INTO BANGXH VALUES ('GDT', 2019, 1, 1, 0, 1, 0, '1-1', 1, 3)
INSERT INTO BANGXH VALUES ('GDT', 2019, 2, 1, 0, 1, 0, '1-1', 1, 4)
INSERT INTO BANGXH VALUES ('GDT', 2019, 3, 2, 1, 1, 0, '3-1', 4, 2)
INSERT INTO BANGXH VALUES ('GDT', 2019, 4, 3, 1, 2, 0, '5-1', 5, 2)
INSERT INTO BANGXH VALUES ('KKH', 2019, 1, 1, 0, 1, 0, '1-1', 1, 2)
INSERT INTO BANGXH VALUES ('KKH', 2019, 2, 2, 0, 2, 0, '3-3', 2, 3)
INSERT INTO BANGXH VALUES ('KKH', 2019, 3, 3, 0, 2, 1, '3-4', 2, 4)
INSERT INTO BANGXH VALUES ('KKH', 2019, 4, 4, 1, 2, 1, '4-4', 5, 3)
INSERT INTO BANGXH VALUES ('SDN', 2019, 1, 1, 0, 0, 1, '0-3', 0, 5)
INSERT INTO BANGXH VALUES ('SDN', 2019, 2, 2, 1, 1, 0, '2-5', 1, 5)
INSERT INTO BANGXH VALUES ('SDN', 2019, 3, 3, 1, 1, 0, '2-5', 1, 2)
INSERT INTO BANGXH VALUES ('SDN', 2019, 4, 2, 1, 1, 0, '2-5', 1, 5)
INSERT INTO BANGXH VALUES ('TPY', 2019, 1, 0, 0, 0, 0, '0-0', 0, 4)
INSERT INTO BANGXH VALUES ('TPY', 2019, 2, 1, 1, 0, 0, '5-0', 3, 1)
INSERT INTO BANGXH VALUES ('TPY', 2019, 3, 2, 1, 0, 1, '5-2', 3, 3)
INSERT INTO BANGXH VALUES ('TPY', 2019, 4, 3, 1, 0, 2, '5-3', 3, 4)

-- 1. Cho biết thông tin của tất cả cầu thủ
select mact, hoten, so, vitri, convert(varchar, ngaysinh, 103) as ngaysinh, diachi from cauthu

-- 2.Hiển thị thông tin các cầu thủ có số áo 7 và chơi ở vị trí tiền vệ
select * from cauthu where so = 7 and vitri = N'Tiền vệ'

-- 3. Cho biết tên, ngày sinh, địa chỉ, điện thoại của các huấn luyện viên
select TENHLV, ngaysinh, diachi, dienthoai from HUANLUYENVIEN

-- 4. Hiện thị thông tin các cầu thủ có quốc tich Việt Nam và đang chơi ở CLB BECAMEX BÌNH DƯƠNG
SELECT CT.MACT, HOTEN, CONVERT(VARCHAR, NGAYSINH, 103) AS NGAYSINH, DIACHI, VITRI, SO
FROM CAUTHU CT INNER JOIN QUOCGIA QG ON CT.MAQG = QG.MAQG
			   INNER JOIN CAULACBO CLB ON CT.MACLB = CLB.MACLB
WHERE TENQG = N'VIỆT NAM' AND TENCLB = N'BECAMEX BÌNH DƯƠNG'

-- 5. Cho biết mã số, tên, ngày sinh, địa chỉ, vị trí của các cầu thủ thuộc đội bóng SHB ĐÀ NẴNG và có quốc tịch BRAZIL
SELECT CT.MACT, HOTEN, CONVERT(VARCHAR, NGAYSINH, 103) AS NGAYSINH, DIACHI, VITRI
FROM CAUTHU CT INNER JOIN QUOCGIA QG ON CT.MAQG = QG.MAQG
			   INNER JOIN CAULACBO CLB ON CT.MACLB = CLB.MACLB
WHERE TENQG = N'BRAZIL' AND TENCLB = N'SHB ĐÀ NẴNG'

-- 6. Hiển thị thông tin các cầu thủ đang thi đấu trong CLB có sân nhà là LONG AN
SELECT MACT, HOTEN, CONVERT(VARCHAR, NGAYSINH, 103) AS NGAYSINH, CT.DIACHI, VITRI
FROM CAUTHU CT INNER JOIN CAULACBO CLB ON CT.MACLB = CLB.MACLB
			   INNER JOIN SANVD SVD ON CLB.MASAN = SVD.MASAN
WHERE TENSAN = N'LONG AN'

-- 7. Cho biết kết quả (mã trận, ngày thi đấu, tên sân , tên CLB1, tên CLB2, kết quả) của các trận đấu vòng 2 mùa bóng 2019
SELECT MATRAN, CONVERT(VARCHAR, NGAYTD, 103) AS NGAYTD, TENSAN, CLB1.TENCLB, CLB2.TENCLB, KETQUA
FROM CAULACBO CLB1 INNER JOIN TRANDAU TD ON CLB1.MACLB = TD.MACLB1
				   INNER JOIN CAULACBO CLB2 ON CLB2.MACLB = TD.MACLB2
				   INNER JOIN SANVD SVD ON TD.MASAN = SVD.MASAN

-- Cô thuý
Select MATRAN,CONVERT(VARCHAR,NGAYTD,103) AS NGAYTD,SAN.TENSAN, CLB1.TENCLB AS TENCLB1,CLB2.TENCLB AS TENCLB2 , KETQUA
FROM CAULACBO CLB1  JOIN TRANDAU TD ON CLB1.MACLB=TD.MACLB1
					JOIN CAULACBO CLB2 ON CLB2.MACLB = TD.MACLB2
					JOIN SANVD SAN ON TD.MASAN=SAN.MASAN

-- 8. Cho biết mã huấn luyện viên, họ tên, ngày sinh, địa chỉ, vai trò và tên cầu lac bộ đang làm việc của các HLV có quốc tịch là Việt Nam
SELECT HLV.MAHLV, TENHLV, CONVERT(VARCHAR, NGAYSINH, 103) AS NGAYSINH, DIACHI, VAITRO, TENCLB
FROM HUANLUYENVIEN HLV JOIN QUOCGIA QG ON HLV.MAQG = QG.MAQG
					   JOIN HLV_CLB HC ON HLV.MAHLV = HC.MAHLV
					   JOIN CAULACBO CLB ON HC.MACLB = CLB.MACLB
WHERE TENQG = N'VIỆT NAM'

-- 9. Lấy tên 3 CLB có điểm cao nhất sau vòng 3 năm 2019
SELECT TOP 3 TENCLB
FROM BANGXH BXH JOIN CAULACBO CLB ON BXH.MACLB = CLB.MACLB
WHERE VONG = 3 AND NAM = '2019'
ORDER BY DIEM DESC

-- cô thuý
SELECT TOP 3 TENCLB
FROM BANGXH BXH INNER JOIN CAULACBO CLB ON BXH.MACLB=CLB.MACLB
WHERE BXH.VONG=3 AND NAM='2019'
ORDER BY DIEM DESC

-- 10. Cho biết mã HLV, họ tên, ngày sinh, địa chỉ, vai trò và têm CLB đang làm việc mà CLB đó đóng ở tỉnh Bình Dương
SELECT HLV.MAHLV, TENHLV, CONVERT(VARCHAR, NGAYSINH, 103) AS NGAYSINH, DIACHI, VAITRO, TENCLB
FROM CAULACBO CLB JOIN TINH TI ON CLB.MATINH = TI.MATINH
				  JOIN HLV_CLB HC ON CLB.MACLB = HC.MACLB
				  JOIN HUANLUYENVIEN HLV ON HC.MAHLV = HLV.MAHLV
WHERE TENTINH = N'BÌNH DƯƠNG'

-- 11. Thống kê số lượng cầu thủ của mỗi câu lạc bộ
SELECT CAUTHU.MACLB, TENCLB, COUNT(MACT) AS [SO CAU THU]
FROM CAUTHU JOIN CAULACBO ON CAUTHU.MACLB = CAULACBO.MACLB
GROUP BY CAUTHU.MACLB, TENCLB

-- 12. Thống kê số lượng cầu thủ nước ngoài (có quốc tịch khác Việt Nam) của mỗi câu lạc bộ
SELECT CAUTHU.MACLB, TENCLB, COUNT(MACT) AS [SO CAU THU NGOAI QUOC]
FROM CAUTHU JOIN CAULACBO ON CAUTHU.MACLB = CAULACBO.MACLB
			JOIN QUOCGIA ON CAUTHU.MAQG = QUOCGIA.MAQG
WHERE TENQG != N'VIỆT NAM'
GROUP BY CAUTHU.MACLB, TENCLB

-- 13. Cho biết mã CLB, tên CLB, tên sân vận động, địa chỉ và số lượng cầu thủ nước ngoài tương ứng của các CLB có nhiều hơn 2 cầu thủ nước ngoài
SELECT CLB.MACLB, TENCLB, TENSAN, SAN.DIACHI, COUNT(MACT) AS [SO CAU THU NGOAI QUOC]
FROM CAULACBO CLB JOIN SANVD SAN ON CLB.MASAN = SAN.MASAN
				  JOIN CAUTHU CT ON CLB.MACLB = CT.MACLB
				  JOIN QUOCGIA QG ON CT.MAQG = QG.MAQG
WHERE TENQG != N'VIỆT NAM'
GROUP BY CLB.MACLB, TENCLB, TENSAN, SAN.DIACHI
HAVING COUNT(MACT) > 2

-- 14. Cho biết tên tỉnh, số lượng cầu thủ đang thi đấu ở vị trí tiền đạo trong các CLB thuộc địa bàn tỉnh đó quản lý
SELECT TINH.MATINH, TENTINH, COUNT(MACT) AS [SO CAU THU TIEN DAO]
FROM CAUTHU JOIN CAULACBO ON CAUTHU.MACLB = CAULACBO.MACLB
			JOIN TINH ON CAULACBO.MATINH = TINH.MATINH
 WHERE VITRI = N'TIỀN ĐẠO'
GROUP BY TINH.MATINH, TENTINH

-- 15. Cho biết tên các CLB, tên tỉnh mà CLB đang đóng nằm ở vị trí cao nhất của BXH vòng 3 năm 2019
SELECT TENCLB, TENTINH, DIEM
FROM BANGXH BXH JOIN CAULACBO CLB ON BXH.MACLB = CLB.MACLB
				JOIN TINH TI ON CLB.MATINH = TI.MATINH
WHERE VONG = 3 AND NAM = 2019 AND DIEM >= ALL (SELECT DIEM FROM BANGXH WHERE VONG = 3 AND NAM = 2019)

-- 16. Cho biết tên HLV dang nắm giữ 1 vị trí trong 1 CLB mà chưa có số điện thoại 
SELECT TENHLV
FROM HUANLUYENVIEN
WHERE MAHLV IN (SELECT MAHLV FROM HLV_CLB)
	  AND DIENTHOAI IS NULL

-- 17. Liệt kê các HLV thuộc quốc gia Việt Nam chưa làm công tác luyện tại bất kỳ CLB nào
SELECT *
FROM HUANLUYENVIEN
WHERE MAHLV NOT IN (SELECT HC.MAHLV FROM HLV_CLB HC JOIN HUANLUYENVIEN HLV ON HC.MAHLV = HLV.MAHLV
													JOIN QUOCGIA QG ON HLV.MAQG = QG.MAQG)

-- 18. Liệt kê các cầu thủ đang thi đấu trong các CLB có thứ hạng ở vòng 3 năm 2019 lớn hơn 6 hoặc nhỏ hơn 3
SELECT MACT, HOTEN, NGAYSINH, DIACHI, VITRI, MACLB
FROM CAUTHU
WHERE MACLB IN (SELECT MACLB FROM BANGXH WHERE VONG = 3 AND NAM = 2019 AND (HANG < 3 OR HANG > 6))

-- 19. Cho biết danh sách các trận đấu (NGAYTD, TENSAN, TENCLB1, TENCLB2, KETQUA) của các CLB đang xếp hạng cao nhất tính hết vòng 3 năm 2019
SELECT CONVERT(VARCHAR, NGAYTD, 103) AS NGAYTD, TENSAN, CLB1.TENCLB AS [CLB 1], CLB2.TENCLB AS [CLB 2], KETQUA
FROM TRANDAU TD JOIN SANVD SAN ON TD.MASAN = SAN.MASAN
				JOIN CAULACBO CLB1 ON TD.MACLB1 = CLB1.MACLB
				JOIN CAULACBO CLB2 ON TD.MACLB2 = CLB2.MACLB
WHERE TD.MACLB1 IN (SELECT MACLB FROM BANGXH WHERE VONG = 3 AND NAM = 2019 AND DIEM >= ALL (SELECT DIEM FROM BANGXH WHERE VONG = 3 AND NAM = 2019))
   OR TD.MACLB2 IN (SELECT MACLB FROM BANGXH WHERE VONG = 3 AND NAM = 2019 AND DIEM >= ALL (SELECT DIEM FROM BANGXH WHERE VONG = 3 AND NAM = 2019))

-- 20. Cho biết NGAYTD, TENSAN, TENCLB1, TENCLB2, KETQUA của các trận diễn ra vào tháng 3 trên sân nhà mà không bị thủng lưới
SELECT CONVERT(VARCHAR, NGAYTD, 103) AS NGAYTD, TENSAN, CLB1.TENCLB AS [CLB 1], CLB2.TENCLB AS [CLB 2], KETQUA
FROM TRANDAU TD JOIN CAULACBO CLB1 ON TD.MACLB1 = CLB1.MACLB
				JOIN CAULACBO CLB2 ON TD.MACLB2 = CLB2.MACLB
				JOIN SANVD SAN ON TD.MASAN = SAN.MASAN
WHERE MONTH(NGAYTD) = 3 AND TD.MASAN = CLB1.MASAN AND LEFT(KETQUA, 1) = '0'
UNION
SELECT CONVERT(VARCHAR, NGAYTD, 103) AS NGAYTD, TENSAN, CLB1.TENCLB AS [CLB 1], CLB2.TENCLB AS [CLB 2], KETQUA
FROM TRANDAU TD JOIN CAULACBO CLB1 ON TD.MACLB1 = CLB1.MACLB
				JOIN CAULACBO CLB2 ON TD.MACLB2 = CLB2.MACLB
				JOIN SANVD SAN ON TD.MASAN = SAN.MASAN
WHERE MONTH(NGAYTD) = 3 AND TD.MASAN = CLB2.MASAN AND RIGHT(KETQUA, 1) = '0'

-- 21. Cho biết mã số, tên, ngày sinh của những cầu thủ có họ lót là 'Công'
SELECT MACT, HOTEN, CONVERT(VARCHAR, NGAYSINH, 103) AS [NGAY SINH]
FROM CAUTHU
WHERE HOTEN LIKE N'% CÔNG %'

-- 22. Cho biết mã số, tên, ngày sinh của những cầu thủ có họ KHÔNG PHẢI là 'NGUYỄN'
SELECT MACT, HOTEN, CONVERT(VARCHAR, NGAYSINH, 103) AS [NGAY SINH]
FROM CAUTHU
WHERE HOTEN NOT LIKE N'NGUYỄN%'

-- 23. Cho biết mã HLV, họ tên, ngày sinh, địa chỉ của những HLV Việt Nam có tuổi nằm trong khoảng 35 - 40
SELECT MAHLV, TENHLV, CONVERT(VARCHAR, NGAYSINH, 103) AS NGAYSINH, DIACHI
FROM HUANLUYENVIEN HLV JOIN QUOCGIA QG ON HLV.MAQG = QG.MAQG
WHERE (DATEDIFF(YEAR, NGAYSINH, GETDATE()) BETWEEN 35 AND 40) AND TENQG = N'VIỆT NAM'

-- 24. Cho biết tên CLB có HLV trưởng sinh vào ngày 20 tháng 5
SELECT TENCLB
FROM CAULACBO CLB JOIN HLV_CLB HC ON CLB.MACLB = HC.MACLB
				  JOIN HUANLUYENVIEN HLV ON HC.MAHLV = HLV.MAHLV
WHERE VAITRO = N'HLV CHÍNH' AND MONTH(NGAYSINH) = 5 AND DAY(NGAYSINH) = 20


-- 25. Cho biết tên CLB, tên tỉnh mà CLB đang đóng có số bàn thắng nhiều nhất tính đến vòng 3 năm 2019
SELECT TENCLB, TENTINH
FROM CAULACBO CLB JOIN TINH TI ON CLB.MATINH = TI.MATINH
				  JOIN BANGXH BXH ON CLB.MACLB = BXH.MACLB
WHERE VONG = 3 AND NAM = 2019 AND LEFT(HIEUSO, PATINDEX('%-%', HIEUSO) - 1) >= ALL (SELECT LEFT(HIEUSO, PATINDEX('%-%', HIEUSO) - 1)
																					FROM BANGXH
																					WHERE VONG = 3 AND NAM = 2019)

-- 26. Cho biết mã CLB, tên CLB, tên sân vận động, địa chỉ và số lượng cầu thủ nước ngoài tương ứng của các CLB có nhiều hơn 2 cầu thủ nước ngoài
SELECT  CLB.MACLB, TENCLB, TENSAN, DIACHI, SL
FROM CAULACBO CLB JOIN (SELECT MACLB, COUNT(MACT) AS SL FROM CAUTHU JOIN QUOCGIA ON CAUTHU.MAQG = QUOCGIA.MAQG
						WHERE TENQG != N'VIỆT NAM'
						GROUP BY MACLB HAVING COUNT(MACT) > 2) TMP ON CLB.MACLB = TMP.MACLB
				  JOIN SANVD SAN ON CLB.MASAN = SAN.MASAN

-- 27. Cho biết tên CLB, tên tỉnh mà CLB đang đóng có hiệu số bàn thắng bại cao nhất năm 2019
SELECT TENCLB, TENTINH, HIEUSO
FROM BANGXH BXH JOIN CAULACBO CLB ON BXH.MACLB = CLB.MACLB
				JOIN TINH TI ON CLB.MATINH = TI.MATINH
WHERE NAM = 2019 AND VONG >= ALL (SELECT VONG FROM BANGXH)
	AND CONVERT(INT, LEFT(HIEUSO, PATINDEX('%-%', HIEUSO) - 1)) - CONVERT(INT, RIGHT(HIEUSO, LEN(HIEUSO) - PATINDEX('%-%', HIEUSO)))
				>= ALL (SELECT CONVERT(INT, LEFT(HIEUSO, PATINDEX('%-%', HIEUSO) - 1)) 
						- CONVERT(INT, RIGHT(HIEUSO, LEN(HIEUSO) - PATINDEX('%-%', HIEUSO)))
						FROM BANGXH WHERE NAM = 2019 AND VONG >= ALL (SELECT VONG FROM BANGXH))

-- 28. Cho biết ds các trận đấu (NGAYTD, TENSAN, TENCLB1, TENCLB2, KETQUA) của CLB có thứ hạng thấp nhất trong BXH vòng 3 năm 2019
SELECT CONVERT(VARCHAR, NGAYTD, 103) AS NGAYTD, TENSAN, CLB1.TENCLB AS [CLB 1], CLB2.TENCLB AS [CLB 2], KETQUA
FROM TRANDAU TD JOIN SANVD SAN ON TD.MASAN = SAN.MASAN
				JOIN CAULACBO CLB1 ON TD.MACLB1 = CLB1.MACLB
				JOIN CAULACBO CLB2 ON TD.MACLB2 = CLB2.MACLB
WHERE TD.MACLB1 IN (SELECT MACLB FROM BANGXH WHERE VONG = 3 AND NAM = 2019 AND DIEM <= ALL (SELECT DIEM FROM BANGXH WHERE VONG = 3 AND NAM = 2019))
   OR TD.MACLB2 IN (SELECT MACLB FROM BANGXH WHERE VONG = 3 AND NAM = 2019 AND DIEM <= ALL (SELECT DIEM FROM BANGXH WHERE VONG = 3 AND NAM = 2019))

-- 29. Cho biết mã CLB, tên CLB đã tham gia thi đấu với tất cả các CLB còn lại kể cả sân nhà và sân khách trong mùa giải 2019
SELECT MACLB, TENCLB
FROM CAULACBO CLB
WHERE (SELECT COUNT(MATRAN) FROM TRANDAU WHERE CLB.MACLB IN (TRANDAU.MACLB1, TRANDAU.MACLB2) AND NAM = 2019) = (SELECT COUNT(MACLB) -1 FROM CAULACBO)

-- 30. Cho biết mã CLB, tên CLB đã tham gia thi đấu với tất cả các CLB còn lại chỉ tính sân nhà trong mùa giải 2019
SELECT MACLB, TENCLB
FROM CAULACBO CLB
WHERE (SELECT COUNT(MATRAN) FROM TRANDAU WHERE CLB.MASAN = TRANDAU.MASAN AND NAM = 2019) = (SELECT COUNT(MACLB) -1 FROM CAULACBO)

-- 31. Khi thêm cầu thủ mới, vị trí của cầu thủ chỉ thuộc các vị trí sau: 'THỦ MÔN', 'TIỀN ĐẠO', 'TIỀN VỆ', 'TRUNG VỆ', 'HẬU VỆ'
ALTER TABLE CAUTHU
ADD CHECK (VITRI IN (N'THỦ MÔN', N'TIỀN ĐẠO', N'TIỀN VỆ', N'TRUNG VỆ', N'HẬU VỆ'))

-- 32. Khi phân công HLV, kiểm tra vai trò của HLV chỉ thuộc một trong các vai trò sau: 'HLV CHÍNH', 'HLV PHỤ', 'HLV THỂ LỰC', 'HLV THỦ MÔN'
ALTER TABLE HLV_CLB
ADD CHECK (VAITRO IN (N'HLV CHÍNH', N'HLV PHỤ', N'HLV THỂ LỰC', N'HLV THỦ MÔN'))

-- 33. Khi thêm cầu thủ mới, kiểm tra cầu thủ đó phải từ 18 tuổi trở lên (chỉ tính năm sinh)
ALTER TABLE CAUTHU
ADD CHECK (DATEDIFF(YEAR, NGAYSINH, GETDATE()) >= 18)

-- 34. Kiểm tra kết quả trận đấu có dạng số_bàn_thắng-số_bàn_thua
ALTER TABLE BANGXH
ADD CHECK (HIEUSO LIKE '%-%')